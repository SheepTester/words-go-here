import{Vector2 as dt}from"https://sheeptester.github.io/javascripts/Vector2.js";function ne(a,g){return class extends a{constructor(...E){super(...E),g(this)}}}var te=ne(Array,a=>a.fill(0)),Y=1e-6;function ee(a){function g(d=0,p=0){let M=new a(2);return d!==void 0&&(M[0]=d,p!==void 0&&(M[1]=p)),M}let E=g;function U(d,p,M){let n=M??new a(2);return n[0]=d,n[1]=p,n}function A(d,p){let M=p??new a(2);return M[0]=Math.ceil(d[0]),M[1]=Math.ceil(d[1]),M}function R(d,p){let M=p??new a(2);return M[0]=Math.floor(d[0]),M[1]=Math.floor(d[1]),M}function G(d,p){let M=p??new a(2);return M[0]=Math.round(d[0]),M[1]=Math.round(d[1]),M}function W(d,p=0,M=1,n){let u=n??new a(2);return u[0]=Math.min(M,Math.max(p,d[0])),u[1]=Math.min(M,Math.max(p,d[1])),u}function $(d,p,M){let n=M??new a(2);return n[0]=d[0]+p[0],n[1]=d[1]+p[1],n}function X(d,p,M,n){let u=n??new a(2);return u[0]=d[0]+p[0]*M,u[1]=d[1]+p[1]*M,u}function Z(d,p){let M=d[0],n=d[1],u=p[0],o=p[1],c=Math.sqrt(M*M+n*n),e=Math.sqrt(u*u+o*o),r=c*e,h=r&&pn(d,p)/r;return Math.acos(h)}function F(d,p,M){let n=M??new a(2);return n[0]=d[0]-p[0],n[1]=d[1]-p[1],n}let Q=F;function K(d,p){return Math.abs(d[0]-p[0])<Y&&Math.abs(d[1]-p[1])<Y}function cn(d,p){return d[0]===p[0]&&d[1]===p[1]}function en(d,p,M,n){let u=n??new a(2);return u[0]=d[0]+M*(p[0]-d[0]),u[1]=d[1]+M*(p[1]-d[1]),u}function fn(d,p,M,n){let u=n??new a(2);return u[0]=d[0]+M[0]*(p[0]-d[0]),u[1]=d[1]+M[1]*(p[1]-d[1]),u}function an(d,p,M){let n=M??new a(2);return n[0]=Math.max(d[0],p[0]),n[1]=Math.max(d[1],p[1]),n}function rn(d,p,M){let n=M??new a(2);return n[0]=Math.min(d[0],p[0]),n[1]=Math.min(d[1],p[1]),n}function _(d,p,M){let n=M??new a(2);return n[0]=d[0]*p,n[1]=d[1]*p,n}let nn=_;function on(d,p,M){let n=M??new a(2);return n[0]=d[0]/p,n[1]=d[1]/p,n}function Mn(d,p){let M=p??new a(2);return M[0]=1/d[0],M[1]=1/d[1],M}let yn=Mn;function gn(d,p,M){let n=M??new a(3),u=d[0]*p[1]-d[1]*p[0];return n[0]=0,n[1]=0,n[2]=u,n}function pn(d,p){return d[0]*p[0]+d[1]*p[1]}function un(d){let p=d[0],M=d[1];return Math.sqrt(p*p+M*M)}let I=un;function H(d){let p=d[0],M=d[1];return p*p+M*M}let tn=H;function N(d,p){let M=d[0]-p[0],n=d[1]-p[1];return Math.sqrt(M*M+n*n)}let m=N;function O(d,p){let M=d[0]-p[0],n=d[1]-p[1];return M*M+n*n}let b=O;function ln(d,p){let M=p??new a(2),n=d[0],u=d[1],o=Math.sqrt(n*n+u*u);return o>1e-5?(M[0]=n/o,M[1]=u/o):(M[0]=0,M[1]=0),M}function Sn(d,p){let M=p??new a(2);return M[0]=-d[0],M[1]=-d[1],M}function sn(d,p){let M=p??new a(2);return M[0]=d[0],M[1]=d[1],M}let Fn=sn;function vn(d,p,M){let n=M??new a(2);return n[0]=d[0]*p[0],n[1]=d[1]*p[1],n}let Wn=vn;function qn(d,p,M){let n=M??new a(2);return n[0]=d[0]/p[0],n[1]=d[1]/p[1],n}let On=qn;function Ln(d=1,p){let M=p??new a(2),n=Math.random()*2*Math.PI;return M[0]=Math.cos(n)*d,M[1]=Math.sin(n)*d,M}function y(d){let p=d??new a(2);return p[0]=0,p[1]=0,p}function z(d,p,M){let n=M??new a(2),u=d[0],o=d[1];return n[0]=u*p[0]+o*p[4]+p[12],n[1]=u*p[1]+o*p[5]+p[13],n}function w(d,p,M){let n=M??new a(2),u=d[0],o=d[1];return n[0]=p[0]*u+p[4]*o+p[8],n[1]=p[1]*u+p[5]*o+p[9],n}function t(d,p,M,n){let u=n??new a(2),o=d[0]-p[0],c=d[1]-p[1],e=Math.sin(M),r=Math.cos(M);return u[0]=o*r-c*e+p[0],u[1]=o*e+c*r+p[1],u}function i(d,p,M){let n=M??new a(2);return ln(d,n),_(n,p,n)}function s(d,p,M){let n=M??new a(2);return un(d)>p?i(d,p,n):sn(d,n)}function f(d,p,M){let n=M??new a(2);return en(d,p,.5,n)}return{create:g,fromValues:E,set:U,ceil:A,floor:R,round:G,clamp:W,add:$,addScaled:X,angle:Z,subtract:F,sub:Q,equalsApproximately:K,equals:cn,lerp:en,lerpV:fn,max:an,min:rn,mulScalar:_,scale:nn,divScalar:on,inverse:Mn,invert:yn,cross:gn,dot:pn,length:un,len:I,lengthSq:H,lenSq:tn,distance:N,dist:m,distanceSq:O,distSq:b,normalize:ln,negate:Sn,copy:sn,clone:Fn,multiply:vn,mul:Wn,divide:qn,div:On,random:Ln,zero:y,transformMat4:z,transformMat3:w,rotate:t,setLength:i,truncate:s,midpoint:f}}var Ut=new Map;function Rt(a){let g=Ut.get(a);return g||(g=ee(a),Ut.set(a,g)),g}function oe(a){function g(e,r,h){let l=new a(3);return e!==void 0&&(l[0]=e,r!==void 0&&(l[1]=r,h!==void 0&&(l[2]=h))),l}let E=g;function U(e,r,h,l){let D=l??new a(3);return D[0]=e,D[1]=r,D[2]=h,D}function A(e,r){let h=r??new a(3);return h[0]=Math.ceil(e[0]),h[1]=Math.ceil(e[1]),h[2]=Math.ceil(e[2]),h}function R(e,r){let h=r??new a(3);return h[0]=Math.floor(e[0]),h[1]=Math.floor(e[1]),h[2]=Math.floor(e[2]),h}function G(e,r){let h=r??new a(3);return h[0]=Math.round(e[0]),h[1]=Math.round(e[1]),h[2]=Math.round(e[2]),h}function W(e,r=0,h=1,l){let D=l??new a(3);return D[0]=Math.min(h,Math.max(r,e[0])),D[1]=Math.min(h,Math.max(r,e[1])),D[2]=Math.min(h,Math.max(r,e[2])),D}function $(e,r,h){let l=h??new a(3);return l[0]=e[0]+r[0],l[1]=e[1]+r[1],l[2]=e[2]+r[2],l}function X(e,r,h,l){let D=l??new a(3);return D[0]=e[0]+r[0]*h,D[1]=e[1]+r[1]*h,D[2]=e[2]+r[2]*h,D}function Z(e,r){let h=e[0],l=e[1],D=e[2],x=r[0],k=r[1],S=r[2],P=Math.sqrt(h*h+l*l+D*D),T=Math.sqrt(x*x+k*k+S*S),v=P*T,L=v&&pn(e,r)/v;return Math.acos(L)}function F(e,r,h){let l=h??new a(3);return l[0]=e[0]-r[0],l[1]=e[1]-r[1],l[2]=e[2]-r[2],l}let Q=F;function K(e,r){return Math.abs(e[0]-r[0])<Y&&Math.abs(e[1]-r[1])<Y&&Math.abs(e[2]-r[2])<Y}function cn(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function en(e,r,h,l){let D=l??new a(3);return D[0]=e[0]+h*(r[0]-e[0]),D[1]=e[1]+h*(r[1]-e[1]),D[2]=e[2]+h*(r[2]-e[2]),D}function fn(e,r,h,l){let D=l??new a(3);return D[0]=e[0]+h[0]*(r[0]-e[0]),D[1]=e[1]+h[1]*(r[1]-e[1]),D[2]=e[2]+h[2]*(r[2]-e[2]),D}function an(e,r,h){let l=h??new a(3);return l[0]=Math.max(e[0],r[0]),l[1]=Math.max(e[1],r[1]),l[2]=Math.max(e[2],r[2]),l}function rn(e,r,h){let l=h??new a(3);return l[0]=Math.min(e[0],r[0]),l[1]=Math.min(e[1],r[1]),l[2]=Math.min(e[2],r[2]),l}function _(e,r,h){let l=h??new a(3);return l[0]=e[0]*r,l[1]=e[1]*r,l[2]=e[2]*r,l}let nn=_;function on(e,r,h){let l=h??new a(3);return l[0]=e[0]/r,l[1]=e[1]/r,l[2]=e[2]/r,l}function Mn(e,r){let h=r??new a(3);return h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],h}let yn=Mn;function gn(e,r,h){let l=h??new a(3),D=e[2]*r[0]-e[0]*r[2],x=e[0]*r[1]-e[1]*r[0];return l[0]=e[1]*r[2]-e[2]*r[1],l[1]=D,l[2]=x,l}function pn(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function un(e){let r=e[0],h=e[1],l=e[2];return Math.sqrt(r*r+h*h+l*l)}let I=un;function H(e){let r=e[0],h=e[1],l=e[2];return r*r+h*h+l*l}let tn=H;function N(e,r){let h=e[0]-r[0],l=e[1]-r[1],D=e[2]-r[2];return Math.sqrt(h*h+l*l+D*D)}let m=N;function O(e,r){let h=e[0]-r[0],l=e[1]-r[1],D=e[2]-r[2];return h*h+l*l+D*D}let b=O;function ln(e,r){let h=r??new a(3),l=e[0],D=e[1],x=e[2],k=Math.sqrt(l*l+D*D+x*x);return k>1e-5?(h[0]=l/k,h[1]=D/k,h[2]=x/k):(h[0]=0,h[1]=0,h[2]=0),h}function Sn(e,r){let h=r??new a(3);return h[0]=-e[0],h[1]=-e[1],h[2]=-e[2],h}function sn(e,r){let h=r??new a(3);return h[0]=e[0],h[1]=e[1],h[2]=e[2],h}let Fn=sn;function vn(e,r,h){let l=h??new a(3);return l[0]=e[0]*r[0],l[1]=e[1]*r[1],l[2]=e[2]*r[2],l}let Wn=vn;function qn(e,r,h){let l=h??new a(3);return l[0]=e[0]/r[0],l[1]=e[1]/r[1],l[2]=e[2]/r[2],l}let On=qn;function Ln(e=1,r){let h=r??new a(3),l=Math.random()*2*Math.PI,D=Math.random()*2-1,x=Math.sqrt(1-D*D)*e;return h[0]=Math.cos(l)*x,h[1]=Math.sin(l)*x,h[2]=D*e,h}function y(e){let r=e??new a(3);return r[0]=0,r[1]=0,r[2]=0,r}function z(e,r,h){let l=h??new a(3),D=e[0],x=e[1],k=e[2],S=r[3]*D+r[7]*x+r[11]*k+r[15]||1;return l[0]=(r[0]*D+r[4]*x+r[8]*k+r[12])/S,l[1]=(r[1]*D+r[5]*x+r[9]*k+r[13])/S,l[2]=(r[2]*D+r[6]*x+r[10]*k+r[14])/S,l}function w(e,r,h){let l=h??new a(3),D=e[0],x=e[1],k=e[2];return l[0]=D*r[0]+x*r[4]+k*r[8],l[1]=D*r[1]+x*r[5]+k*r[9],l[2]=D*r[2]+x*r[6]+k*r[10],l}function t(e,r,h){let l=h??new a(3),D=e[0],x=e[1],k=e[2];return l[0]=D*r[0]+x*r[4]+k*r[8],l[1]=D*r[1]+x*r[5]+k*r[9],l[2]=D*r[2]+x*r[6]+k*r[10],l}function i(e,r,h){let l=h??new a(3),D=r[0],x=r[1],k=r[2],S=r[3]*2,P=e[0],T=e[1],v=e[2],L=x*v-k*T,q=k*P-D*v,B=D*T-x*P;return l[0]=P+L*S+(x*B-k*q)*2,l[1]=T+q*S+(k*L-D*B)*2,l[2]=v+B*S+(D*q-x*L)*2,l}function s(e,r){let h=r??new a(3);return h[0]=e[12],h[1]=e[13],h[2]=e[14],h}function f(e,r,h){let l=h??new a(3),D=r*4;return l[0]=e[D+0],l[1]=e[D+1],l[2]=e[D+2],l}function d(e,r){let h=r??new a(3),l=e[0],D=e[1],x=e[2],k=e[4],S=e[5],P=e[6],T=e[8],v=e[9],L=e[10];return h[0]=Math.sqrt(l*l+D*D+x*x),h[1]=Math.sqrt(k*k+S*S+P*P),h[2]=Math.sqrt(T*T+v*v+L*L),h}function p(e,r,h,l){let D=l??new a(3),x=[],k=[];return x[0]=e[0]-r[0],x[1]=e[1]-r[1],x[2]=e[2]-r[2],k[0]=x[0],k[1]=x[1]*Math.cos(h)-x[2]*Math.sin(h),k[2]=x[1]*Math.sin(h)+x[2]*Math.cos(h),D[0]=k[0]+r[0],D[1]=k[1]+r[1],D[2]=k[2]+r[2],D}function M(e,r,h,l){let D=l??new a(3),x=[],k=[];return x[0]=e[0]-r[0],x[1]=e[1]-r[1],x[2]=e[2]-r[2],k[0]=x[2]*Math.sin(h)+x[0]*Math.cos(h),k[1]=x[1],k[2]=x[2]*Math.cos(h)-x[0]*Math.sin(h),D[0]=k[0]+r[0],D[1]=k[1]+r[1],D[2]=k[2]+r[2],D}function n(e,r,h,l){let D=l??new a(3),x=[],k=[];return x[0]=e[0]-r[0],x[1]=e[1]-r[1],x[2]=e[2]-r[2],k[0]=x[0]*Math.cos(h)-x[1]*Math.sin(h),k[1]=x[0]*Math.sin(h)+x[1]*Math.cos(h),k[2]=x[2],D[0]=k[0]+r[0],D[1]=k[1]+r[1],D[2]=k[2]+r[2],D}function u(e,r,h){let l=h??new a(3);return ln(e,l),_(l,r,l)}function o(e,r,h){let l=h??new a(3);return un(e)>r?u(e,r,l):sn(e,l)}function c(e,r,h){let l=h??new a(3);return en(e,r,.5,l)}return{create:g,fromValues:E,set:U,ceil:A,floor:R,round:G,clamp:W,add:$,addScaled:X,angle:Z,subtract:F,sub:Q,equalsApproximately:K,equals:cn,lerp:en,lerpV:fn,max:an,min:rn,mulScalar:_,scale:nn,divScalar:on,inverse:Mn,invert:yn,cross:gn,dot:pn,length:un,len:I,lengthSq:H,lenSq:tn,distance:N,dist:m,distanceSq:O,distSq:b,normalize:ln,negate:Sn,copy:sn,clone:Fn,multiply:vn,mul:Wn,divide:qn,div:On,random:Ln,zero:y,transformMat4:z,transformMat4Upper3x3:w,transformMat3:t,transformQuat:i,getTranslation:s,getAxis:f,getScaling:d,rotateX:p,rotateY:M,rotateZ:n,setLength:u,truncate:o,midpoint:c}}var Gt=new Map;function ct(a){let g=Gt.get(a);return g||(g=oe(a),Gt.set(a,g)),g}function se(a){let g=Rt(a),E=ct(a);function U(t,i,s,f,d,p,M,n,u){let o=new a(12);return o[3]=0,o[7]=0,o[11]=0,t!==void 0&&(o[0]=t,i!==void 0&&(o[1]=i,s!==void 0&&(o[2]=s,f!==void 0&&(o[4]=f,d!==void 0&&(o[5]=d,p!==void 0&&(o[6]=p,M!==void 0&&(o[8]=M,n!==void 0&&(o[9]=n,u!==void 0&&(o[10]=u))))))))),o}function A(t,i,s,f,d,p,M,n,u,o){let c=o??new a(12);return c[0]=t,c[1]=i,c[2]=s,c[3]=0,c[4]=f,c[5]=d,c[6]=p,c[7]=0,c[8]=M,c[9]=n,c[10]=u,c[11]=0,c}function R(t,i){let s=i??new a(12);return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=0,s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=0,s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=0,s}function G(t,i){let s=i??new a(12),f=t[0],d=t[1],p=t[2],M=t[3],n=f+f,u=d+d,o=p+p,c=f*n,e=d*n,r=d*u,h=p*n,l=p*u,D=p*o,x=M*n,k=M*u,S=M*o;return s[0]=1-r-D,s[1]=e+S,s[2]=h-k,s[3]=0,s[4]=e-S,s[5]=1-c-D,s[6]=l+x,s[7]=0,s[8]=h+k,s[9]=l-x,s[10]=1-c-r,s[11]=0,s}function W(t,i){let s=i??new a(12);return s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s[4]=-t[4],s[5]=-t[5],s[6]=-t[6],s[8]=-t[8],s[9]=-t[9],s[10]=-t[10],s}function $(t,i,s){let f=s??new a(12);return f[0]=t[0]*i,f[1]=t[1]*i,f[2]=t[2]*i,f[4]=t[4]*i,f[5]=t[5]*i,f[6]=t[6]*i,f[8]=t[8]*i,f[9]=t[9]*i,f[10]=t[10]*i,f}let X=$;function Z(t,i,s){let f=s??new a(12);return f[0]=t[0]+i[0],f[1]=t[1]+i[1],f[2]=t[2]+i[2],f[4]=t[4]+i[4],f[5]=t[5]+i[5],f[6]=t[6]+i[6],f[8]=t[8]+i[8],f[9]=t[9]+i[9],f[10]=t[10]+i[10],f}function F(t,i){let s=i??new a(12);return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[8]=t[8],s[9]=t[9],s[10]=t[10],s}let Q=F;function K(t,i){return Math.abs(t[0]-i[0])<Y&&Math.abs(t[1]-i[1])<Y&&Math.abs(t[2]-i[2])<Y&&Math.abs(t[4]-i[4])<Y&&Math.abs(t[5]-i[5])<Y&&Math.abs(t[6]-i[6])<Y&&Math.abs(t[8]-i[8])<Y&&Math.abs(t[9]-i[9])<Y&&Math.abs(t[10]-i[10])<Y}function cn(t,i){return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]}function en(t){let i=t??new a(12);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=1,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function fn(t,i){let s=i??new a(12);if(s===t){let r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[6],t[6]=t[9],t[9]=r,s}let f=t[0],d=t[1],p=t[2],M=t[4],n=t[5],u=t[6],o=t[8],c=t[9],e=t[10];return s[0]=f,s[1]=M,s[2]=o,s[4]=d,s[5]=n,s[6]=c,s[8]=p,s[9]=u,s[10]=e,s}function an(t,i){let s=i??new a(12),f=t[0],d=t[1],p=t[2],M=t[4],n=t[5],u=t[6],o=t[8],c=t[9],e=t[10],r=e*n-u*c,h=-e*M+u*o,l=c*M-n*o,D=1/(f*r+d*h+p*l);return s[0]=r*D,s[1]=(-e*d+p*c)*D,s[2]=(u*d-p*n)*D,s[4]=h*D,s[5]=(e*f-p*o)*D,s[6]=(-u*f+p*M)*D,s[8]=l*D,s[9]=(-c*f+d*o)*D,s[10]=(n*f-d*M)*D,s}function rn(t){let i=t[0],s=t[1],f=t[2],d=t[4],p=t[5],M=t[6],n=t[8],u=t[9],o=t[10];return i*(p*o-u*M)-d*(s*o-u*f)+n*(s*M-p*f)}let _=an;function nn(t,i,s){let f=s??new a(12),d=t[0],p=t[1],M=t[2],n=t[4],u=t[5],o=t[6],c=t[8],e=t[9],r=t[10],h=i[0],l=i[1],D=i[2],x=i[4],k=i[5],S=i[6],P=i[8],T=i[9],v=i[10];return f[0]=d*h+n*l+c*D,f[1]=p*h+u*l+e*D,f[2]=M*h+o*l+r*D,f[4]=d*x+n*k+c*S,f[5]=p*x+u*k+e*S,f[6]=M*x+o*k+r*S,f[8]=d*P+n*T+c*v,f[9]=p*P+u*T+e*v,f[10]=M*P+o*T+r*v,f}let on=nn;function Mn(t,i,s){let f=s??en();return t!==f&&(f[0]=t[0],f[1]=t[1],f[2]=t[2],f[4]=t[4],f[5]=t[5],f[6]=t[6]),f[8]=i[0],f[9]=i[1],f[10]=1,f}function yn(t,i){let s=i??g.create();return s[0]=t[8],s[1]=t[9],s}function gn(t,i,s){let f=s??g.create(),d=i*4;return f[0]=t[d+0],f[1]=t[d+1],f}function pn(t,i,s,f){let d=f===t?t:F(t,f),p=s*4;return d[p+0]=i[0],d[p+1]=i[1],d}function un(t,i){let s=i??g.create(),f=t[0],d=t[1],p=t[4],M=t[5];return s[0]=Math.sqrt(f*f+d*d),s[1]=Math.sqrt(p*p+M*M),s}function I(t,i){let s=i??E.create(),f=t[0],d=t[1],p=t[2],M=t[4],n=t[5],u=t[6],o=t[8],c=t[9],e=t[10];return s[0]=Math.sqrt(f*f+d*d+p*p),s[1]=Math.sqrt(M*M+n*n+u*u),s[2]=Math.sqrt(o*o+c*c+e*e),s}function H(t,i){let s=i??new a(12);return s[0]=1,s[1]=0,s[2]=0,s[4]=0,s[5]=1,s[6]=0,s[8]=t[0],s[9]=t[1],s[10]=1,s}function tn(t,i,s){let f=s??new a(12),d=i[0],p=i[1],M=t[0],n=t[1],u=t[2],o=t[4],c=t[5],e=t[6],r=t[8],h=t[9],l=t[10];return t!==f&&(f[0]=M,f[1]=n,f[2]=u,f[4]=o,f[5]=c,f[6]=e),f[8]=M*d+o*p+r,f[9]=n*d+c*p+h,f[10]=u*d+e*p+l,f}function N(t,i){let s=i??new a(12),f=Math.cos(t),d=Math.sin(t);return s[0]=f,s[1]=d,s[2]=0,s[4]=-d,s[5]=f,s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function m(t,i,s){let f=s??new a(12),d=t[0],p=t[1],M=t[2],n=t[4],u=t[5],o=t[6],c=Math.cos(i),e=Math.sin(i);return f[0]=c*d+e*n,f[1]=c*p+e*u,f[2]=c*M+e*o,f[4]=c*n-e*d,f[5]=c*u-e*p,f[6]=c*o-e*M,t!==f&&(f[8]=t[8],f[9]=t[9],f[10]=t[10]),f}function O(t,i){let s=i??new a(12),f=Math.cos(t),d=Math.sin(t);return s[0]=1,s[1]=0,s[2]=0,s[4]=0,s[5]=f,s[6]=d,s[8]=0,s[9]=-d,s[10]=f,s}function b(t,i,s){let f=s??new a(12),d=t[4],p=t[5],M=t[6],n=t[8],u=t[9],o=t[10],c=Math.cos(i),e=Math.sin(i);return f[4]=c*d+e*n,f[5]=c*p+e*u,f[6]=c*M+e*o,f[8]=c*n-e*d,f[9]=c*u-e*p,f[10]=c*o-e*M,t!==f&&(f[0]=t[0],f[1]=t[1],f[2]=t[2]),f}function ln(t,i){let s=i??new a(12),f=Math.cos(t),d=Math.sin(t);return s[0]=f,s[1]=0,s[2]=-d,s[4]=0,s[5]=1,s[6]=0,s[8]=d,s[9]=0,s[10]=f,s}function Sn(t,i,s){let f=s??new a(12),d=t[0],p=t[1],M=t[2],n=t[8],u=t[9],o=t[10],c=Math.cos(i),e=Math.sin(i);return f[0]=c*d-e*n,f[1]=c*p-e*u,f[2]=c*M-e*o,f[8]=c*n+e*d,f[9]=c*u+e*p,f[10]=c*o+e*M,t!==f&&(f[4]=t[4],f[5]=t[5],f[6]=t[6]),f}let sn=N,Fn=m;function vn(t,i){let s=i??new a(12);return s[0]=t[0],s[1]=0,s[2]=0,s[4]=0,s[5]=t[1],s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function Wn(t,i,s){let f=s??new a(12),d=i[0],p=i[1];return f[0]=d*t[0],f[1]=d*t[1],f[2]=d*t[2],f[4]=p*t[4],f[5]=p*t[5],f[6]=p*t[6],t!==f&&(f[8]=t[8],f[9]=t[9],f[10]=t[10]),f}function qn(t,i){let s=i??new a(12);return s[0]=t[0],s[1]=0,s[2]=0,s[4]=0,s[5]=t[1],s[6]=0,s[8]=0,s[9]=0,s[10]=t[2],s}function On(t,i,s){let f=s??new a(12),d=i[0],p=i[1],M=i[2];return f[0]=d*t[0],f[1]=d*t[1],f[2]=d*t[2],f[4]=p*t[4],f[5]=p*t[5],f[6]=p*t[6],f[8]=M*t[8],f[9]=M*t[9],f[10]=M*t[10],f}function Ln(t,i){let s=i??new a(12);return s[0]=t,s[1]=0,s[2]=0,s[4]=0,s[5]=t,s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function y(t,i,s){let f=s??new a(12);return f[0]=i*t[0],f[1]=i*t[1],f[2]=i*t[2],f[4]=i*t[4],f[5]=i*t[5],f[6]=i*t[6],t!==f&&(f[8]=t[8],f[9]=t[9],f[10]=t[10]),f}function z(t,i){let s=i??new a(12);return s[0]=t,s[1]=0,s[2]=0,s[4]=0,s[5]=t,s[6]=0,s[8]=0,s[9]=0,s[10]=t,s}function w(t,i,s){let f=s??new a(12);return f[0]=i*t[0],f[1]=i*t[1],f[2]=i*t[2],f[4]=i*t[4],f[5]=i*t[5],f[6]=i*t[6],f[8]=i*t[8],f[9]=i*t[9],f[10]=i*t[10],f}return{add:Z,clone:Q,copy:F,create:U,determinant:rn,equals:cn,equalsApproximately:K,fromMat4:R,fromQuat:G,get3DScaling:I,getAxis:gn,getScaling:un,getTranslation:yn,identity:en,inverse:an,invert:_,mul:on,mulScalar:X,multiply:nn,multiplyScalar:$,negate:W,rotate:m,rotateX:b,rotateY:Sn,rotateZ:Fn,rotation:N,rotationX:O,rotationY:ln,rotationZ:sn,scale:Wn,scale3D:On,scaling:vn,scaling3D:qn,set:A,setAxis:pn,setTranslation:Mn,translate:tn,translation:H,transpose:fn,uniformScale:y,uniformScale3D:w,uniformScaling:Ln,uniformScaling3D:z}}var vt=new Map;function ce(a){let g=vt.get(a);return g||(g=se(a),vt.set(a,g)),g}function re(a){let g=ct(a);function E(n,u,o,c,e,r,h,l,D,x,k,S,P,T,v,L){let q=new a(16);return n!==void 0&&(q[0]=n,u!==void 0&&(q[1]=u,o!==void 0&&(q[2]=o,c!==void 0&&(q[3]=c,e!==void 0&&(q[4]=e,r!==void 0&&(q[5]=r,h!==void 0&&(q[6]=h,l!==void 0&&(q[7]=l,D!==void 0&&(q[8]=D,x!==void 0&&(q[9]=x,k!==void 0&&(q[10]=k,S!==void 0&&(q[11]=S,P!==void 0&&(q[12]=P,T!==void 0&&(q[13]=T,v!==void 0&&(q[14]=v,L!==void 0&&(q[15]=L)))))))))))))))),q}function U(n,u,o,c,e,r,h,l,D,x,k,S,P,T,v,L,q){let B=q??new a(16);return B[0]=n,B[1]=u,B[2]=o,B[3]=c,B[4]=e,B[5]=r,B[6]=h,B[7]=l,B[8]=D,B[9]=x,B[10]=k,B[11]=S,B[12]=P,B[13]=T,B[14]=v,B[15]=L,B}function A(n,u){let o=u??new a(16);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=0,o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=0,o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function R(n,u){let o=u??new a(16),c=n[0],e=n[1],r=n[2],h=n[3],l=c+c,D=e+e,x=r+r,k=c*l,S=e*l,P=e*D,T=r*l,v=r*D,L=r*x,q=h*l,B=h*D,C=h*x;return o[0]=1-P-L,o[1]=S+C,o[2]=T-B,o[3]=0,o[4]=S-C,o[5]=1-k-L,o[6]=v+q,o[7]=0,o[8]=T+B,o[9]=v-q,o[10]=1-k-P,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function G(n,u){let o=u??new a(16);return o[0]=-n[0],o[1]=-n[1],o[2]=-n[2],o[3]=-n[3],o[4]=-n[4],o[5]=-n[5],o[6]=-n[6],o[7]=-n[7],o[8]=-n[8],o[9]=-n[9],o[10]=-n[10],o[11]=-n[11],o[12]=-n[12],o[13]=-n[13],o[14]=-n[14],o[15]=-n[15],o}function W(n,u,o){let c=o??new a(16);return c[0]=n[0]+u[0],c[1]=n[1]+u[1],c[2]=n[2]+u[2],c[3]=n[3]+u[3],c[4]=n[4]+u[4],c[5]=n[5]+u[5],c[6]=n[6]+u[6],c[7]=n[7]+u[7],c[8]=n[8]+u[8],c[9]=n[9]+u[9],c[10]=n[10]+u[10],c[11]=n[11]+u[11],c[12]=n[12]+u[12],c[13]=n[13]+u[13],c[14]=n[14]+u[14],c[15]=n[15]+u[15],c}function $(n,u,o){let c=o??new a(16);return c[0]=n[0]*u,c[1]=n[1]*u,c[2]=n[2]*u,c[3]=n[3]*u,c[4]=n[4]*u,c[5]=n[5]*u,c[6]=n[6]*u,c[7]=n[7]*u,c[8]=n[8]*u,c[9]=n[9]*u,c[10]=n[10]*u,c[11]=n[11]*u,c[12]=n[12]*u,c[13]=n[13]*u,c[14]=n[14]*u,c[15]=n[15]*u,c}let X=$;function Z(n,u){let o=u??new a(16);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o}let F=Z;function Q(n,u){return Math.abs(n[0]-u[0])<Y&&Math.abs(n[1]-u[1])<Y&&Math.abs(n[2]-u[2])<Y&&Math.abs(n[3]-u[3])<Y&&Math.abs(n[4]-u[4])<Y&&Math.abs(n[5]-u[5])<Y&&Math.abs(n[6]-u[6])<Y&&Math.abs(n[7]-u[7])<Y&&Math.abs(n[8]-u[8])<Y&&Math.abs(n[9]-u[9])<Y&&Math.abs(n[10]-u[10])<Y&&Math.abs(n[11]-u[11])<Y&&Math.abs(n[12]-u[12])<Y&&Math.abs(n[13]-u[13])<Y&&Math.abs(n[14]-u[14])<Y&&Math.abs(n[15]-u[15])<Y}function K(n,u){return n[0]===u[0]&&n[1]===u[1]&&n[2]===u[2]&&n[3]===u[3]&&n[4]===u[4]&&n[5]===u[5]&&n[6]===u[6]&&n[7]===u[7]&&n[8]===u[8]&&n[9]===u[9]&&n[10]===u[10]&&n[11]===u[11]&&n[12]===u[12]&&n[13]===u[13]&&n[14]===u[14]&&n[15]===u[15]}function cn(n){let u=n??new a(16);return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function en(n,u){let o=u??new a(16);if(o===n){let J;return J=n[1],n[1]=n[4],n[4]=J,J=n[2],n[2]=n[8],n[8]=J,J=n[3],n[3]=n[12],n[12]=J,J=n[6],n[6]=n[9],n[9]=J,J=n[7],n[7]=n[13],n[13]=J,J=n[11],n[11]=n[14],n[14]=J,o}let c=n[0],e=n[1],r=n[2],h=n[3],l=n[4],D=n[5],x=n[6],k=n[7],S=n[8],P=n[9],T=n[10],v=n[11],L=n[12],q=n[13],B=n[14],C=n[15];return o[0]=c,o[1]=l,o[2]=S,o[3]=L,o[4]=e,o[5]=D,o[6]=P,o[7]=q,o[8]=r,o[9]=x,o[10]=T,o[11]=B,o[12]=h,o[13]=k,o[14]=v,o[15]=C,o}function fn(n,u){let o=u??new a(16),c=n[0],e=n[1],r=n[2],h=n[3],l=n[4],D=n[5],x=n[6],k=n[7],S=n[8],P=n[9],T=n[10],v=n[11],L=n[12],q=n[13],B=n[14],C=n[15],J=T*C,wn=B*v,hn=x*C,dn=B*k,Dn=x*v,xn=T*k,kn=r*C,zn=B*h,Pn=r*v,Tn=T*h,mn=r*k,In=x*h,Un=S*q,Gn=L*P,Bn=l*q,$n=L*D,Rn=l*P,Jn=S*D,Cn=c*q,nt=L*e,tt=c*P,et=S*e,ot=c*D,st=l*e,Et=J*D+dn*P+Dn*q-(wn*D+hn*P+xn*q),St=wn*e+kn*P+Tn*q-(J*e+zn*P+Pn*q),mt=hn*e+zn*D+mn*q-(dn*e+kn*D+In*q),It=xn*e+Pn*D+In*P-(Dn*e+Tn*D+mn*P),An=1/(c*Et+l*St+S*mt+L*It);return o[0]=An*Et,o[1]=An*St,o[2]=An*mt,o[3]=An*It,o[4]=An*(wn*l+hn*S+xn*L-(J*l+dn*S+Dn*L)),o[5]=An*(J*c+zn*S+Pn*L-(wn*c+kn*S+Tn*L)),o[6]=An*(dn*c+kn*l+In*L-(hn*c+zn*l+mn*L)),o[7]=An*(Dn*c+Tn*l+mn*S-(xn*c+Pn*l+In*S)),o[8]=An*(Un*k+$n*v+Rn*C-(Gn*k+Bn*v+Jn*C)),o[9]=An*(Gn*h+Cn*v+et*C-(Un*h+nt*v+tt*C)),o[10]=An*(Bn*h+nt*k+ot*C-($n*h+Cn*k+st*C)),o[11]=An*(Jn*h+tt*k+st*v-(Rn*h+et*k+ot*v)),o[12]=An*(Bn*T+Jn*B+Gn*x-(Rn*B+Un*x+$n*T)),o[13]=An*(tt*B+Un*r+nt*T-(Cn*T+et*B+Gn*r)),o[14]=An*(Cn*x+st*B+$n*r-(ot*B+Bn*r+nt*x)),o[15]=An*(ot*T+Rn*r+et*x-(tt*x+st*T+Jn*r)),o}function an(n){let u=n[0],o=n[1],c=n[2],e=n[3],r=n[4],h=n[5],l=n[6],D=n[7],x=n[8],k=n[9],S=n[10],P=n[11],T=n[12],v=n[13],L=n[14],q=n[15],B=S*q,C=L*P,J=l*q,wn=L*D,hn=l*P,dn=S*D,Dn=c*q,xn=L*e,kn=c*P,zn=S*e,Pn=c*D,Tn=l*e,mn=B*h+wn*k+hn*v-(C*h+J*k+dn*v),In=C*o+Dn*k+zn*v-(B*o+xn*k+kn*v),Un=J*o+xn*h+Pn*v-(wn*o+Dn*h+Tn*v),Gn=dn*o+kn*h+Tn*k-(hn*o+zn*h+Pn*k);return u*mn+r*In+x*Un+T*Gn}let rn=fn;function _(n,u,o){let c=o??new a(16),e=n[0],r=n[1],h=n[2],l=n[3],D=n[4],x=n[5],k=n[6],S=n[7],P=n[8],T=n[9],v=n[10],L=n[11],q=n[12],B=n[13],C=n[14],J=n[15],wn=u[0],hn=u[1],dn=u[2],Dn=u[3],xn=u[4],kn=u[5],zn=u[6],Pn=u[7],Tn=u[8],mn=u[9],In=u[10],Un=u[11],Gn=u[12],Bn=u[13],$n=u[14],Rn=u[15];return c[0]=e*wn+D*hn+P*dn+q*Dn,c[1]=r*wn+x*hn+T*dn+B*Dn,c[2]=h*wn+k*hn+v*dn+C*Dn,c[3]=l*wn+S*hn+L*dn+J*Dn,c[4]=e*xn+D*kn+P*zn+q*Pn,c[5]=r*xn+x*kn+T*zn+B*Pn,c[6]=h*xn+k*kn+v*zn+C*Pn,c[7]=l*xn+S*kn+L*zn+J*Pn,c[8]=e*Tn+D*mn+P*In+q*Un,c[9]=r*Tn+x*mn+T*In+B*Un,c[10]=h*Tn+k*mn+v*In+C*Un,c[11]=l*Tn+S*mn+L*In+J*Un,c[12]=e*Gn+D*Bn+P*$n+q*Rn,c[13]=r*Gn+x*Bn+T*$n+B*Rn,c[14]=h*Gn+k*Bn+v*$n+C*Rn,c[15]=l*Gn+S*Bn+L*$n+J*Rn,c}let nn=_;function on(n,u,o){let c=o??cn();return n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11]),c[12]=u[0],c[13]=u[1],c[14]=u[2],c[15]=1,c}function Mn(n,u){let o=u??g.create();return o[0]=n[12],o[1]=n[13],o[2]=n[14],o}function yn(n,u,o){let c=o??g.create(),e=u*4;return c[0]=n[e+0],c[1]=n[e+1],c[2]=n[e+2],c}function gn(n,u,o,c){let e=c===n?c:Z(n,c),r=o*4;return e[r+0]=u[0],e[r+1]=u[1],e[r+2]=u[2],e}function pn(n,u){let o=u??g.create(),c=n[0],e=n[1],r=n[2],h=n[4],l=n[5],D=n[6],x=n[8],k=n[9],S=n[10];return o[0]=Math.sqrt(c*c+e*e+r*r),o[1]=Math.sqrt(h*h+l*l+D*D),o[2]=Math.sqrt(x*x+k*k+S*S),o}function un(n,u,o,c,e){let r=e??new a(16),h=Math.tan(Math.PI*.5-.5*n);if(r[0]=h/u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,Number.isFinite(c)){let l=1/(o-c);r[10]=c*l,r[14]=c*o*l}else r[10]=-1,r[14]=-o;return r}function I(n,u,o,c=1/0,e){let r=e??new a(16),h=1/Math.tan(n*.5);if(r[0]=h/u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c===1/0)r[10]=0,r[14]=o;else{let l=1/(c-o);r[10]=o*l,r[14]=c*o*l}return r}function H(n,u,o,c,e,r,h){let l=h??new a(16);return l[0]=2/(u-n),l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2/(c-o),l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1/(e-r),l[11]=0,l[12]=(u+n)/(n-u),l[13]=(c+o)/(o-c),l[14]=e/(e-r),l[15]=1,l}function tn(n,u,o,c,e,r,h){let l=h??new a(16),D=u-n,x=c-o,k=e-r;return l[0]=2*e/D,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*e/x,l[6]=0,l[7]=0,l[8]=(n+u)/D,l[9]=(c+o)/x,l[10]=r/k,l[11]=-1,l[12]=0,l[13]=0,l[14]=e*r/k,l[15]=0,l}function N(n,u,o,c,e,r=1/0,h){let l=h??new a(16),D=u-n,x=c-o;if(l[0]=2*e/D,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*e/x,l[6]=0,l[7]=0,l[8]=(n+u)/D,l[9]=(c+o)/x,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,r===1/0)l[10]=0,l[14]=e;else{let k=1/(r-e);l[10]=e*k,l[14]=r*e*k}return l}let m=g.create(),O=g.create(),b=g.create();function ln(n,u,o,c){let e=c??new a(16);return g.normalize(g.subtract(u,n,b),b),g.normalize(g.cross(o,b,m),m),g.normalize(g.cross(b,m,O),O),e[0]=m[0],e[1]=m[1],e[2]=m[2],e[3]=0,e[4]=O[0],e[5]=O[1],e[6]=O[2],e[7]=0,e[8]=b[0],e[9]=b[1],e[10]=b[2],e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Sn(n,u,o,c){let e=c??new a(16);return g.normalize(g.subtract(n,u,b),b),g.normalize(g.cross(o,b,m),m),g.normalize(g.cross(b,m,O),O),e[0]=m[0],e[1]=m[1],e[2]=m[2],e[3]=0,e[4]=O[0],e[5]=O[1],e[6]=O[2],e[7]=0,e[8]=b[0],e[9]=b[1],e[10]=b[2],e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function sn(n,u,o,c){let e=c??new a(16);return g.normalize(g.subtract(n,u,b),b),g.normalize(g.cross(o,b,m),m),g.normalize(g.cross(b,m,O),O),e[0]=m[0],e[1]=O[0],e[2]=b[0],e[3]=0,e[4]=m[1],e[5]=O[1],e[6]=b[1],e[7]=0,e[8]=m[2],e[9]=O[2],e[10]=b[2],e[11]=0,e[12]=-(m[0]*n[0]+m[1]*n[1]+m[2]*n[2]),e[13]=-(O[0]*n[0]+O[1]*n[1]+O[2]*n[2]),e[14]=-(b[0]*n[0]+b[1]*n[1]+b[2]*n[2]),e[15]=1,e}function Fn(n,u){let o=u??new a(16);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=n[0],o[13]=n[1],o[14]=n[2],o[15]=1,o}function vn(n,u,o){let c=o??new a(16),e=u[0],r=u[1],h=u[2],l=n[0],D=n[1],x=n[2],k=n[3],S=n[4],P=n[5],T=n[6],v=n[7],L=n[8],q=n[9],B=n[10],C=n[11],J=n[12],wn=n[13],hn=n[14],dn=n[15];return n!==c&&(c[0]=l,c[1]=D,c[2]=x,c[3]=k,c[4]=S,c[5]=P,c[6]=T,c[7]=v,c[8]=L,c[9]=q,c[10]=B,c[11]=C),c[12]=l*e+S*r+L*h+J,c[13]=D*e+P*r+q*h+wn,c[14]=x*e+T*r+B*h+hn,c[15]=k*e+v*r+C*h+dn,c}function Wn(n,u){let o=u??new a(16),c=Math.cos(n),e=Math.sin(n);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=c,o[6]=e,o[7]=0,o[8]=0,o[9]=-e,o[10]=c,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function qn(n,u,o){let c=o??new a(16),e=n[4],r=n[5],h=n[6],l=n[7],D=n[8],x=n[9],k=n[10],S=n[11],P=Math.cos(u),T=Math.sin(u);return c[4]=P*e+T*D,c[5]=P*r+T*x,c[6]=P*h+T*k,c[7]=P*l+T*S,c[8]=P*D-T*e,c[9]=P*x-T*r,c[10]=P*k-T*h,c[11]=P*S-T*l,n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c}function On(n,u){let o=u??new a(16),c=Math.cos(n),e=Math.sin(n);return o[0]=c,o[1]=0,o[2]=-e,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=e,o[9]=0,o[10]=c,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ln(n,u,o){let c=o??new a(16),e=n[0],r=n[1],h=n[2],l=n[3],D=n[8],x=n[9],k=n[10],S=n[11],P=Math.cos(u),T=Math.sin(u);return c[0]=P*e-T*D,c[1]=P*r-T*x,c[2]=P*h-T*k,c[3]=P*l-T*S,c[8]=P*D+T*e,c[9]=P*x+T*r,c[10]=P*k+T*h,c[11]=P*S+T*l,n!==c&&(c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c}function y(n,u){let o=u??new a(16),c=Math.cos(n),e=Math.sin(n);return o[0]=c,o[1]=e,o[2]=0,o[3]=0,o[4]=-e,o[5]=c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function z(n,u,o){let c=o??new a(16),e=n[0],r=n[1],h=n[2],l=n[3],D=n[4],x=n[5],k=n[6],S=n[7],P=Math.cos(u),T=Math.sin(u);return c[0]=P*e+T*D,c[1]=P*r+T*x,c[2]=P*h+T*k,c[3]=P*l+T*S,c[4]=P*D-T*e,c[5]=P*x-T*r,c[6]=P*k-T*h,c[7]=P*S-T*l,n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c}function w(n,u,o){let c=o??new a(16),e=n[0],r=n[1],h=n[2],l=Math.sqrt(e*e+r*r+h*h);e/=l,r/=l,h/=l;let D=e*e,x=r*r,k=h*h,S=Math.cos(u),P=Math.sin(u),T=1-S;return c[0]=D+(1-D)*S,c[1]=e*r*T+h*P,c[2]=e*h*T-r*P,c[3]=0,c[4]=e*r*T-h*P,c[5]=x+(1-x)*S,c[6]=r*h*T+e*P,c[7]=0,c[8]=e*h*T+r*P,c[9]=r*h*T-e*P,c[10]=k+(1-k)*S,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}let t=w;function i(n,u,o,c){let e=c??new a(16),r=u[0],h=u[1],l=u[2],D=Math.sqrt(r*r+h*h+l*l);r/=D,h/=D,l/=D;let x=r*r,k=h*h,S=l*l,P=Math.cos(o),T=Math.sin(o),v=1-P,L=x+(1-x)*P,q=r*h*v+l*T,B=r*l*v-h*T,C=r*h*v-l*T,J=k+(1-k)*P,wn=h*l*v+r*T,hn=r*l*v+h*T,dn=h*l*v-r*T,Dn=S+(1-S)*P,xn=n[0],kn=n[1],zn=n[2],Pn=n[3],Tn=n[4],mn=n[5],In=n[6],Un=n[7],Gn=n[8],Bn=n[9],$n=n[10],Rn=n[11];return e[0]=L*xn+q*Tn+B*Gn,e[1]=L*kn+q*mn+B*Bn,e[2]=L*zn+q*In+B*$n,e[3]=L*Pn+q*Un+B*Rn,e[4]=C*xn+J*Tn+wn*Gn,e[5]=C*kn+J*mn+wn*Bn,e[6]=C*zn+J*In+wn*$n,e[7]=C*Pn+J*Un+wn*Rn,e[8]=hn*xn+dn*Tn+Dn*Gn,e[9]=hn*kn+dn*mn+Dn*Bn,e[10]=hn*zn+dn*In+Dn*$n,e[11]=hn*Pn+dn*Un+Dn*Rn,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}let s=i;function f(n,u){let o=u??new a(16);return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function d(n,u,o){let c=o??new a(16),e=u[0],r=u[1],h=u[2];return c[0]=e*n[0],c[1]=e*n[1],c[2]=e*n[2],c[3]=e*n[3],c[4]=r*n[4],c[5]=r*n[5],c[6]=r*n[6],c[7]=r*n[7],c[8]=h*n[8],c[9]=h*n[9],c[10]=h*n[10],c[11]=h*n[11],n!==c&&(c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c}function p(n,u){let o=u??new a(16);return o[0]=n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function M(n,u,o){let c=o??new a(16);return c[0]=u*n[0],c[1]=u*n[1],c[2]=u*n[2],c[3]=u*n[3],c[4]=u*n[4],c[5]=u*n[5],c[6]=u*n[6],c[7]=u*n[7],c[8]=u*n[8],c[9]=u*n[9],c[10]=u*n[10],c[11]=u*n[11],n!==c&&(c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c}return{add:W,aim:ln,axisRotate:i,axisRotation:w,cameraAim:Sn,clone:F,copy:Z,create:E,determinant:an,equals:K,equalsApproximately:Q,fromMat3:A,fromQuat:R,frustum:tn,frustumReverseZ:N,getAxis:yn,getScaling:pn,getTranslation:Mn,identity:cn,inverse:fn,invert:rn,lookAt:sn,mul:nn,mulScalar:X,multiply:_,multiplyScalar:$,negate:G,ortho:H,perspective:un,perspectiveReverseZ:I,rotate:s,rotateX:qn,rotateY:Ln,rotateZ:z,rotation:t,rotationX:Wn,rotationY:On,rotationZ:y,scale:d,scaling:f,set:U,setAxis:gn,setTranslation:on,translate:vn,translation:Fn,transpose:en,uniformScale:M,uniformScaling:p}}var qt=new Map;function ie(a){let g=qt.get(a);return g||(g=re(a),qt.set(a,g)),g}function ue(a){let g=ct(a);function E(y,z,w,t){let i=new a(4);return y!==void 0&&(i[0]=y,z!==void 0&&(i[1]=z,w!==void 0&&(i[2]=w,t!==void 0&&(i[3]=t)))),i}let U=E;function A(y,z,w,t,i){let s=i??new a(4);return s[0]=y,s[1]=z,s[2]=w,s[3]=t,s}function R(y,z,w){let t=w??new a(4),i=z*.5,s=Math.sin(i);return t[0]=s*y[0],t[1]=s*y[1],t[2]=s*y[2],t[3]=Math.cos(i),t}function G(y,z){let w=z??g.create(3),t=Math.acos(y[3])*2,i=Math.sin(t*.5);return i>Y?(w[0]=y[0]/i,w[1]=y[1]/i,w[2]=y[2]/i):(w[0]=1,w[1]=0,w[2]=0),{angle:t,axis:w}}function W(y,z){let w=un(y,z);return Math.acos(2*w*w-1)}function $(y,z,w){let t=w??new a(4),i=y[0],s=y[1],f=y[2],d=y[3],p=z[0],M=z[1],n=z[2],u=z[3];return t[0]=i*u+d*p+s*n-f*M,t[1]=s*u+d*M+f*p-i*n,t[2]=f*u+d*n+i*M-s*p,t[3]=d*u-i*p-s*M-f*n,t}let X=$;function Z(y,z,w){let t=w??new a(4),i=z*.5,s=y[0],f=y[1],d=y[2],p=y[3],M=Math.sin(i),n=Math.cos(i);return t[0]=s*n+p*M,t[1]=f*n+d*M,t[2]=d*n-f*M,t[3]=p*n-s*M,t}function F(y,z,w){let t=w??new a(4),i=z*.5,s=y[0],f=y[1],d=y[2],p=y[3],M=Math.sin(i),n=Math.cos(i);return t[0]=s*n-d*M,t[1]=f*n+p*M,t[2]=d*n+s*M,t[3]=p*n-f*M,t}function Q(y,z,w){let t=w??new a(4),i=z*.5,s=y[0],f=y[1],d=y[2],p=y[3],M=Math.sin(i),n=Math.cos(i);return t[0]=s*n+f*M,t[1]=f*n-s*M,t[2]=d*n+p*M,t[3]=p*n-d*M,t}function K(y,z,w,t){let i=t??new a(4),s=y[0],f=y[1],d=y[2],p=y[3],M=z[0],n=z[1],u=z[2],o=z[3],c=s*M+f*n+d*u+p*o;c<0&&(c=-c,M=-M,n=-n,u=-u,o=-o);let e,r;if(1-c>Y){let h=Math.acos(c),l=Math.sin(h);e=Math.sin((1-w)*h)/l,r=Math.sin(w*h)/l}else e=1-w,r=w;return i[0]=e*s+r*M,i[1]=e*f+r*n,i[2]=e*d+r*u,i[3]=e*p+r*o,i}function cn(y,z){let w=z??new a(4),t=y[0],i=y[1],s=y[2],f=y[3],d=t*t+i*i+s*s+f*f,p=d?1/d:0;return w[0]=-t*p,w[1]=-i*p,w[2]=-s*p,w[3]=f*p,w}function en(y,z){let w=z??new a(4);return w[0]=-y[0],w[1]=-y[1],w[2]=-y[2],w[3]=y[3],w}function fn(y,z){let w=z??new a(4),t=y[0]+y[5]+y[10];if(t>0){let i=Math.sqrt(t+1);w[3]=.5*i;let s=.5/i;w[0]=(y[6]-y[9])*s,w[1]=(y[8]-y[2])*s,w[2]=(y[1]-y[4])*s}else{let i=0;y[5]>y[0]&&(i=1),y[10]>y[i*4+i]&&(i=2);let s=(i+1)%3,f=(i+2)%3,d=Math.sqrt(y[i*4+i]-y[s*4+s]-y[f*4+f]+1);w[i]=.5*d;let p=.5/d;w[3]=(y[s*4+f]-y[f*4+s])*p,w[s]=(y[s*4+i]+y[i*4+s])*p,w[f]=(y[f*4+i]+y[i*4+f])*p}return w}function an(y,z,w,t,i){let s=i??new a(4),f=y*.5,d=z*.5,p=w*.5,M=Math.sin(f),n=Math.cos(f),u=Math.sin(d),o=Math.cos(d),c=Math.sin(p),e=Math.cos(p);switch(t){case"xyz":s[0]=M*o*e+n*u*c,s[1]=n*u*e-M*o*c,s[2]=n*o*c+M*u*e,s[3]=n*o*e-M*u*c;break;case"xzy":s[0]=M*o*e-n*u*c,s[1]=n*u*e-M*o*c,s[2]=n*o*c+M*u*e,s[3]=n*o*e+M*u*c;break;case"yxz":s[0]=M*o*e+n*u*c,s[1]=n*u*e-M*o*c,s[2]=n*o*c-M*u*e,s[3]=n*o*e+M*u*c;break;case"yzx":s[0]=M*o*e+n*u*c,s[1]=n*u*e+M*o*c,s[2]=n*o*c-M*u*e,s[3]=n*o*e-M*u*c;break;case"zxy":s[0]=M*o*e-n*u*c,s[1]=n*u*e+M*o*c,s[2]=n*o*c+M*u*e,s[3]=n*o*e-M*u*c;break;case"zyx":s[0]=M*o*e-n*u*c,s[1]=n*u*e+M*o*c,s[2]=n*o*c-M*u*e,s[3]=n*o*e+M*u*c;break;default:throw new Error(`Unknown rotation order: ${t}`)}return s}function rn(y,z){let w=z??new a(4);return w[0]=y[0],w[1]=y[1],w[2]=y[2],w[3]=y[3],w}let _=rn;function nn(y,z,w){let t=w??new a(4);return t[0]=y[0]+z[0],t[1]=y[1]+z[1],t[2]=y[2]+z[2],t[3]=y[3]+z[3],t}function on(y,z,w){let t=w??new a(4);return t[0]=y[0]-z[0],t[1]=y[1]-z[1],t[2]=y[2]-z[2],t[3]=y[3]-z[3],t}let Mn=on;function yn(y,z,w){let t=w??new a(4);return t[0]=y[0]*z,t[1]=y[1]*z,t[2]=y[2]*z,t[3]=y[3]*z,t}let gn=yn;function pn(y,z,w){let t=w??new a(4);return t[0]=y[0]/z,t[1]=y[1]/z,t[2]=y[2]/z,t[3]=y[3]/z,t}function un(y,z){return y[0]*z[0]+y[1]*z[1]+y[2]*z[2]+y[3]*z[3]}function I(y,z,w,t){let i=t??new a(4);return i[0]=y[0]+w*(z[0]-y[0]),i[1]=y[1]+w*(z[1]-y[1]),i[2]=y[2]+w*(z[2]-y[2]),i[3]=y[3]+w*(z[3]-y[3]),i}function H(y){let z=y[0],w=y[1],t=y[2],i=y[3];return Math.sqrt(z*z+w*w+t*t+i*i)}let tn=H;function N(y){let z=y[0],w=y[1],t=y[2],i=y[3];return z*z+w*w+t*t+i*i}let m=N;function O(y,z){let w=z??new a(4),t=y[0],i=y[1],s=y[2],f=y[3],d=Math.sqrt(t*t+i*i+s*s+f*f);return d>1e-5?(w[0]=t/d,w[1]=i/d,w[2]=s/d,w[3]=f/d):(w[0]=0,w[1]=0,w[2]=0,w[3]=1),w}function b(y,z){return Math.abs(y[0]-z[0])<Y&&Math.abs(y[1]-z[1])<Y&&Math.abs(y[2]-z[2])<Y&&Math.abs(y[3]-z[3])<Y}function ln(y,z){return y[0]===z[0]&&y[1]===z[1]&&y[2]===z[2]&&y[3]===z[3]}function Sn(y){let z=y??new a(4);return z[0]=0,z[1]=0,z[2]=0,z[3]=1,z}let sn=g.create(),Fn=g.create(),vn=g.create();function Wn(y,z,w){let t=w??new a(4),i=g.dot(y,z);return i<-.999999?(g.cross(Fn,y,sn),g.len(sn)<1e-6&&g.cross(vn,y,sn),g.normalize(sn,sn),R(sn,Math.PI,t),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(g.cross(y,z,sn),t[0]=sn[0],t[1]=sn[1],t[2]=sn[2],t[3]=1+i,O(t,t))}let qn=new a(4),On=new a(4);function Ln(y,z,w,t,i,s){let f=s??new a(4);return K(y,t,i,qn),K(z,w,i,On),K(qn,On,2*i*(1-i),f),f}return{create:E,fromValues:U,set:A,fromAxisAngle:R,toAxisAngle:G,angle:W,multiply:$,mul:X,rotateX:Z,rotateY:F,rotateZ:Q,slerp:K,inverse:cn,conjugate:en,fromMat:fn,fromEuler:an,copy:rn,clone:_,add:nn,subtract:on,sub:Mn,mulScalar:yn,scale:gn,divScalar:pn,dot:un,lerp:I,length:H,len:tn,lengthSq:N,lenSq:m,normalize:O,equalsApproximately:b,equals:ln,identity:Sn,rotationTo:Wn,sqlerp:Ln}}var Bt=new Map;function ae(a){let g=Bt.get(a);return g||(g=ue(a),Bt.set(a,g)),g}function fe(a){function g(w,t,i,s){let f=new a(4);return w!==void 0&&(f[0]=w,t!==void 0&&(f[1]=t,i!==void 0&&(f[2]=i,s!==void 0&&(f[3]=s)))),f}let E=g;function U(w,t,i,s,f){let d=f??new a(4);return d[0]=w,d[1]=t,d[2]=i,d[3]=s,d}function A(w,t){let i=t??new a(4);return i[0]=Math.ceil(w[0]),i[1]=Math.ceil(w[1]),i[2]=Math.ceil(w[2]),i[3]=Math.ceil(w[3]),i}function R(w,t){let i=t??new a(4);return i[0]=Math.floor(w[0]),i[1]=Math.floor(w[1]),i[2]=Math.floor(w[2]),i[3]=Math.floor(w[3]),i}function G(w,t){let i=t??new a(4);return i[0]=Math.round(w[0]),i[1]=Math.round(w[1]),i[2]=Math.round(w[2]),i[3]=Math.round(w[3]),i}function W(w,t=0,i=1,s){let f=s??new a(4);return f[0]=Math.min(i,Math.max(t,w[0])),f[1]=Math.min(i,Math.max(t,w[1])),f[2]=Math.min(i,Math.max(t,w[2])),f[3]=Math.min(i,Math.max(t,w[3])),f}function $(w,t,i){let s=i??new a(4);return s[0]=w[0]+t[0],s[1]=w[1]+t[1],s[2]=w[2]+t[2],s[3]=w[3]+t[3],s}function X(w,t,i,s){let f=s??new a(4);return f[0]=w[0]+t[0]*i,f[1]=w[1]+t[1]*i,f[2]=w[2]+t[2]*i,f[3]=w[3]+t[3]*i,f}function Z(w,t,i){let s=i??new a(4);return s[0]=w[0]-t[0],s[1]=w[1]-t[1],s[2]=w[2]-t[2],s[3]=w[3]-t[3],s}let F=Z;function Q(w,t){return Math.abs(w[0]-t[0])<Y&&Math.abs(w[1]-t[1])<Y&&Math.abs(w[2]-t[2])<Y&&Math.abs(w[3]-t[3])<Y}function K(w,t){return w[0]===t[0]&&w[1]===t[1]&&w[2]===t[2]&&w[3]===t[3]}function cn(w,t,i,s){let f=s??new a(4);return f[0]=w[0]+i*(t[0]-w[0]),f[1]=w[1]+i*(t[1]-w[1]),f[2]=w[2]+i*(t[2]-w[2]),f[3]=w[3]+i*(t[3]-w[3]),f}function en(w,t,i,s){let f=s??new a(4);return f[0]=w[0]+i[0]*(t[0]-w[0]),f[1]=w[1]+i[1]*(t[1]-w[1]),f[2]=w[2]+i[2]*(t[2]-w[2]),f[3]=w[3]+i[3]*(t[3]-w[3]),f}function fn(w,t,i){let s=i??new a(4);return s[0]=Math.max(w[0],t[0]),s[1]=Math.max(w[1],t[1]),s[2]=Math.max(w[2],t[2]),s[3]=Math.max(w[3],t[3]),s}function an(w,t,i){let s=i??new a(4);return s[0]=Math.min(w[0],t[0]),s[1]=Math.min(w[1],t[1]),s[2]=Math.min(w[2],t[2]),s[3]=Math.min(w[3],t[3]),s}function rn(w,t,i){let s=i??new a(4);return s[0]=w[0]*t,s[1]=w[1]*t,s[2]=w[2]*t,s[3]=w[3]*t,s}let _=rn;function nn(w,t,i){let s=i??new a(4);return s[0]=w[0]/t,s[1]=w[1]/t,s[2]=w[2]/t,s[3]=w[3]/t,s}function on(w,t){let i=t??new a(4);return i[0]=1/w[0],i[1]=1/w[1],i[2]=1/w[2],i[3]=1/w[3],i}let Mn=on;function yn(w,t){return w[0]*t[0]+w[1]*t[1]+w[2]*t[2]+w[3]*t[3]}function gn(w){let t=w[0],i=w[1],s=w[2],f=w[3];return Math.sqrt(t*t+i*i+s*s+f*f)}let pn=gn;function un(w){let t=w[0],i=w[1],s=w[2],f=w[3];return t*t+i*i+s*s+f*f}let I=un;function H(w,t){let i=w[0]-t[0],s=w[1]-t[1],f=w[2]-t[2],d=w[3]-t[3];return Math.sqrt(i*i+s*s+f*f+d*d)}let tn=H;function N(w,t){let i=w[0]-t[0],s=w[1]-t[1],f=w[2]-t[2],d=w[3]-t[3];return i*i+s*s+f*f+d*d}let m=N;function O(w,t){let i=t??new a(4),s=w[0],f=w[1],d=w[2],p=w[3],M=Math.sqrt(s*s+f*f+d*d+p*p);return M>1e-5?(i[0]=s/M,i[1]=f/M,i[2]=d/M,i[3]=p/M):(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function b(w,t){let i=t??new a(4);return i[0]=-w[0],i[1]=-w[1],i[2]=-w[2],i[3]=-w[3],i}function ln(w,t){let i=t??new a(4);return i[0]=w[0],i[1]=w[1],i[2]=w[2],i[3]=w[3],i}let Sn=ln;function sn(w,t,i){let s=i??new a(4);return s[0]=w[0]*t[0],s[1]=w[1]*t[1],s[2]=w[2]*t[2],s[3]=w[3]*t[3],s}let Fn=sn;function vn(w,t,i){let s=i??new a(4);return s[0]=w[0]/t[0],s[1]=w[1]/t[1],s[2]=w[2]/t[2],s[3]=w[3]/t[3],s}let Wn=vn;function qn(w){let t=w??new a(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function On(w,t,i){let s=i??new a(4),f=w[0],d=w[1],p=w[2],M=w[3];return s[0]=t[0]*f+t[4]*d+t[8]*p+t[12]*M,s[1]=t[1]*f+t[5]*d+t[9]*p+t[13]*M,s[2]=t[2]*f+t[6]*d+t[10]*p+t[14]*M,s[3]=t[3]*f+t[7]*d+t[11]*p+t[15]*M,s}function Ln(w,t,i){let s=i??new a(4);return O(w,s),rn(s,t,s)}function y(w,t,i){let s=i??new a(4);return gn(w)>t?Ln(w,t,s):ln(w,s)}function z(w,t,i){let s=i??new a(4);return cn(w,t,.5,s)}return{create:g,fromValues:E,set:U,ceil:A,floor:R,round:G,clamp:W,add:$,addScaled:X,subtract:Z,sub:F,equalsApproximately:Q,equals:K,lerp:cn,lerpV:en,max:fn,min:an,mulScalar:rn,scale:_,divScalar:nn,inverse:on,invert:Mn,dot:yn,length:gn,len:pn,lengthSq:un,lenSq:I,distance:H,dist:tn,distanceSq:N,distSq:m,normalize:O,negate:b,copy:ln,clone:Sn,multiply:sn,mul:Fn,divide:vn,div:Wn,zero:qn,transformMat4:On,setLength:Ln,truncate:y,midpoint:z}}var $t=new Map;function le(a){let g=$t.get(a);return g||(g=fe(a),$t.set(a,g)),g}function lt(a,g,E,U,A,R){return{mat3:ce(a),mat4:ie(g),quat:ae(E),vec2:Rt(U),vec3:ct(A),vec4:le(R)}}var{mat3:Pe,mat4:Vn,quat:Te,vec2:Ae,vec3:wt,vec4:Ee}=lt(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat3:Se,mat4:me,quat:Ie,vec2:Ue,vec3:Ge,vec4:ve}=lt(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat3:qe,mat4:Be,quat:$e,vec2:Re,vec3:Oe,vec4:Le}=lt(te,Array,Array,Array,Array,Array);var we={1:0,2:1,3:2};function Zn(a){return a===1||a===3}function rt(a){return a!==0}function Ot(a){return we[a]??null}var _n=class{#n;#t;#e;constructor(g,E,U){this.#n=g,this.#t=g.createBuffer({label:`\u{1FA99} uniform @binding(${E})`,size:U,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.#e=E}get entry(){return{binding:this.#e,resource:{buffer:this.#t}}}data(g,E=0){this.#n.queue.writeBuffer(this.#t,E,g)}},Xn=class{group;uniforms;constructor(g,E,U,A){this.group=g.createBindGroup({label:`\u{1F332} group(${U})`,layout:E.getBindGroupLayout(U),entries:Object.values(A).map(R=>R instanceof _n?R.entry:R)}),this.uniforms=A}};function Lt(a,g){return a.pushErrorScope("internal"),a.pushErrorScope("out-of-memory"),a.pushErrorScope("validation"),async()=>{let E=await a.popErrorScope(),U=await a.popErrorScope(),A=await a.popErrorScope();if(E)throw new TypeError(`WebGPU validation error during ${g}.
${E.message}`);if(U)throw new TypeError(`WebGPU out of memory error during ${g}.
${U.message}`);if(A)throw new TypeError(`WebGPU internal error during ${g}.
${A.message}`)}}async function Ft(a,g={}){let E=await navigator.gpu.requestAdapter();if(!E)throw new TypeError("Failed to obtain WebGPU adapter.");let U=E.features.has("timestamp-query"),A=await E.requestDevice({requiredFeatures:U?["timestamp-query"]:[]});A.lost.then(I=>{console.warn("WebGPU device lost. :(",I.message,I)});let R=Lt(A,"initialization"),G=U?A.createQuerySet({type:"timestamp",count:2}):null,W=G?A.createBuffer({size:G.count*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}):null,$=W?A.createBuffer({size:W.size,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}):null,X=A.createShaderModule({label:"\u{1F60E} shaders \u{1F60E}",code:await fetch("./shader.wgsl").then(I=>I.text())}),{messages:Z}=await X.getCompilationInfo();if(Z.some(I=>I.type==="error"))throw console.log(Z),new SyntaxError("Shader failed to compile.");let F=A.createRenderPipeline({label:"\u2728 pipeline \u2728",layout:"auto",vertex:{module:X,entryPoint:"vertex_main",buffers:[{arrayStride:8,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"uint32x2"}]}]},fragment:{module:X,entryPoint:"fragment_main",targets:[{format:a,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{}}}]},primitive:{cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),Q=A.createShaderModule({label:"\u{1F62E} post processing shader \u{1F62E}",code:await fetch("./post-processing.wgsl").then(I=>I.text())}),{messages:K}=await Q.getCompilationInfo();if(K.some(I=>I.type==="error"))throw console.log(K),new SyntaxError("Post-processing shader failed to compile.");let cn=A.createRenderPipeline({label:"\u{1F3A8} post-processing pipeline \u{1F3A8}",layout:"auto",vertex:{module:Q,entryPoint:"vertex_main"},fragment:{module:Q,entryPoint:"fragment_main",targets:[{format:a}]}}),en={},fn=[];function an(I){en[`${I.chunk.position[0]},${I.chunk.position[1]},${I.chunk.position[2]}`]=I,fn.push(I);for(let H=-1;H<=1;H++)for(let tn=-1;tn<=1;tn++)for(let N=-1;N<=1;N++){let m=en[`${I.chunk.position[0]+H},${I.chunk.position[1]+tn},${I.chunk.position[2]+N}`];m&&(I.chunk.neighbors[H+1][tn+1][N+1]=m.chunk,m.chunk.neighbors[1-H][1-tn][1-N]=I.chunk)}}function rn(I){let H=new Nn(I),tn=new jn(H,A,F);for(let N=0;N<j;N++)for(let m=0;m<j;m++)for(let O=0;O<j;O++)Math.random()<(j-N)/j&&H.block(m,N,O,(Math.floor(I[0]/2)+I[2])%2===0?1:2);an(tn)}for(let I=-1;I<=1;I++)for(let H=-1;H<=1;H++)rn([I,0,H]);let _=new Nn([0,1,0]);_.block(1,3,6,3),_.block(1,3,3,3),_.block(2,4,2,3),_.block(5,3,3,3),_.block(5,4,2,3),_.block(9,3,3,3),_.block(9,4,2,3),_.block(10,4,2,3),_.block(5,3,6,3),_.block(5,4,7,3),_.block(6,4,6,3),_.block(9,3,6,3),_.block(9,4,7,3),_.block(10,4,6,3),_.block(10,4,7,3),an(new jn(_,A,F));let nn=await fetch("./textures.png").then(I=>I.blob()).then(I=>createImageBitmap(I,{colorSpaceConversion:"none"})),on=A.createTexture({label:"texture",format:"rgba8unorm",size:[nn.width,nn.height],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});A.queue.copyExternalImageToTexture({source:nn,flipY:!0},{texture:on},{width:nn.width,height:nn.height});let Mn=A.createSampler(),yn=new Xn(A,F,0,{perspective:new _n(A,0,64),camera:new _n(A,1,64),sampler:{binding:2,resource:Mn},texture:{binding:3,resource:on.createView()},textureSize:new _n(A,4,8)});yn.uniforms.textureSize.data(new Float32Array([nn.width/16,nn.height/16]));let gn=new Xn(A,cn,0,{canvasSize:new _n(A,0,8),sampler:{binding:1,resource:Mn}}),pn=null,un=null;return await R(),{device:A,resize:(I,H)=>{yn.uniforms.perspective.data(new Float32Array(Vn.perspective(Math.PI/2,I/H,.1,1e3))),gn.uniforms.canvasSize.data(new Float32Array([I,H])),pn?.destroy(),pn=A.createTexture({size:[I,H],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),un?.destroy(),un=A.createTexture({size:[I,H],format:a,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})},render:async(I,H)=>{if(!pn||!un)throw new Error("Attempted render before resize() was called.");let tn=Lt(A,"render");yn.uniforms.camera.data(new Float32Array(H));let N=A.createCommandEncoder({label:"Xx encoder xX "});{let m=N.beginRenderPass({label:"Xx render pass xX",colorAttachments:[{view:un.createView(),clearValue:[.75,.85,1,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:pn.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"},timestampWrites:G?{querySet:G,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}:void 0});m.setPipeline(F),m.setBindGroup(0,yn.group);for(let O of fn)O.render(m);m.end(),G&&W&&$&&(N.resolveQuerySet(G,0,G.count,W,0),$.mapState==="unmapped"&&N.copyBufferToBuffer(W,0,$,0,$.size))}{let m=N.beginRenderPass({label:"Xx post processing pass xX",colorAttachments:[{view:I.createView(),clearValue:[1,0,1,1],loadOp:"clear",storeOp:"store"}]});m.setPipeline(cn),m.setBindGroup(0,gn.group),m.setBindGroup(1,new Xn(A,cn,1,{texture:{binding:0,resource:un.createView()}}).group),m.draw(6),m.end()}A.queue.submit([N.finish()]),U&&$?.mapState==="unmapped"&&$.mapAsync(GPUMapMode.READ).then(()=>{let m=new BigInt64Array($.getMappedRange());g.onGpuTime?.(m[1]-m[0]),$.unmap()}),await tn()},getBlock:(I,H,tn)=>{let N=Math.floor(I/j),m=Math.floor(H/j),O=Math.floor(tn/j),b=en[`${N},${m},${O}`];return b?b.chunk.block(I-N*j,H-m*j,tn-O*j)??0:0},setBlock:(I,H,tn,N)=>{let m=Math.floor(I/j),O=Math.floor(H/j),b=Math.floor(tn/j);en[`${m},${O},${b}`]||an(new jn(new Nn([m,O,b]),A,F));let ln=en[`${m},${O},${b}`];ln.chunk.block(I-m*j,H-O*j,tn-b*j,N),ln.refreshMesh(g.onMeshBuildTime);for(let Sn of ln.chunk.getAdjacentNeighbors(I-m*j,H-O*j,tn-b*j))en[`${Sn.position[0]},${Sn.position[1]},${Sn.position[2]}`]?.refreshMesh(g.onMeshBuildTime)}}}var j=32;var he=[{face:0,normal:[0,0,-1]},{face:1,normal:[0,0,1]},{face:2,normal:[-1,0,0]},{face:3,normal:[1,0,0]},{face:4,normal:[0,-1,0]},{face:5,normal:[0,1,0]}],de=[[0,0],[0,1],[1,1],[1,1],[1,0],[0,0]];function pe(a,g){let E=de[g],U=a&1?[1-E[0],E[1],1]:[E[0],E[1],0];return a&4?[U[0],U[2],1-U[1]]:a&2?[U[2],U[1],1-U[0]]:U}function Me(a,g){return a!==g&&!Zn(g)}function ht(a){return a<0?{coord:a+j,chunk:0}:a>=j?{coord:a-j,chunk:2}:{coord:a,chunk:1}}var Nn=class{#n=new Uint8Array(j*j*j);position;neighbors=Array.from({length:3},()=>Array.from({length:3},()=>[null,null,null]));constructor(g){this.position=g,this.neighbors[1][1][1]=this}block(g,E,U,A){let{coord:R,chunk:G}=ht(g),{coord:W,chunk:$}=ht(E),{coord:X,chunk:Z}=ht(U),F=(R*j+W)*j+X,Q=this.neighbors[G][$][Z];return Q?A!==void 0?(Q.#n[F]=A,A):Q.#n[F]:0}mesh(g){let E=[];for(let R=0;R<j;R++)for(let G=0;G<j;G++)for(let W=0;W<j;W++){let $=this.block(R,G,W),X=Ot($);if(!($===null||X===null)){for(let{face:Z,normal:[F,Q,K]}of he)if(Me($,this.block(R+F,G+Q,W+K))){let cn=0,en=0;for(let[fn,an]of[0,1,4,3].entries()){let[rn,_,nn]=pe(Z,an),on=+Zn(this.block(R+(F||(rn?1:-1)),G+(Q||(_?1:-1)),W+(K||(nn?1:-1))))+(F===0?+Zn(this.block(R+(F||(rn?1:-1)),G+Q,W+K)):0)+(Q===0?+Zn(this.block(R+F,G+(Q||(_?1:-1)),W+K)):0)+(K===0?+Zn(this.block(R+F,G+Q,W+(K||(nn?1:-1)))):0);cn|=on<<fn*2}E.push(R,G,W,Z,X,cn,0,0)}}}let U=new Uint8Array(E),A=g.createBuffer({label:`chunk (${this.position.join(", ")}) vertex buffer vertices`,size:U.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});return g.queue.writeBuffer(A,0,U),A}getAdjacentNeighbors(g,E,U){let A=new Set;for(let R of[1,g===0?0:g===j-1?2:1])for(let G of[1,E===0?0:E===j-1?2:1])for(let W of[1,U===0?0:U===j-1?2:1]){let $=this.neighbors[R][G][W];$&&A.add($)}return A.delete(this),Array.from(A)}},jn=class{chunk;device;chunkGroup;vertices=null;constructor(g,E,U){this.chunk=g,this.device=E,this.chunkGroup=new Xn(E,U,1,{transform:new _n(E,0,64)}),this.chunkGroup.uniforms.transform.data(Vn.translation(g.position.map(A=>A*j)))}refreshMesh(g){let E=performance.now();return this.vertices=this.chunk.mesh(this.device),g?.(performance.now()-E),this.vertices}render(g){this.vertices??=this.chunk.mesh(this.device),g.setBindGroup(1,this.chunkGroup.group),g.setVertexBuffer(0,this.vertices),g.draw(6,this.vertices.size/8)}};function*Wt(a,[g,E,U],[A,R,G],W=64){let $=0,X=Math.floor(g),Z=Math.floor(E),F=Math.floor(U),Q=Math.sign(A),K=Math.sign(R),cn=Math.sign(G),en=Math.abs(1/A),fn=Math.abs(1/R),an=Math.abs(1/G),rn=en<1/0?en*(Q>0?X+1-g:g-X):1/0,_=fn<1/0?fn*(K>0?Z+1-E:E-Z):1/0,nn=an<1/0?an*(cn>0?F+1-U:U-F):1/0,on=null;for(;$<=W;)switch(a(X,Z,F)&&(yield{block:[X,Z,F],position:[g+$*A,E+$*R,U+$*G],normal:[on==="x"?-Q:0,on==="y"?-K:0,on==="z"?-cn:0]}),Math.min(rn,_,nn)){case rn:X+=Q,$=rn,rn+=en,on="x";break;case _:Z+=K,$=_,_+=fn,on="y";break;case nn:F+=cn,$=nn,nn+=an,on="z";break;default:throw new Error("The minimum is none of these. ??")}}var bt=document.getElementById("error");function At(a){let g=a instanceof Error?a.message:String(a);g.includes("exited the lock")||(bt?.append(Object.assign(document.createElement("span"),{textContent:g})),bt?.classList.remove("no-error"))}window.addEventListener("error",a=>{At(a.error)});window.addEventListener("unhandledrejection",a=>{At(a.reason)});function ye(a){throw a}var yt=document.getElementById("perf"),Zt=0,Dt=0,it=0,Nt=0n,gt=0n,Kn=0n,jt=0,xt=0,ut=0;function kt(){yt&&(yt.textContent=[` cpu:${(Zt*1e3).toFixed(0).padStart(9," ")}ns (avg${(Dt/it*1e3).toFixed(0).padStart(9," ")}ns)`,` gpu:${Nt.toString().padStart(9," ")}ns (avg${(Kn>0n?String(gt/Kn):"?").padStart(9," ")}ns)`,`mesh:${(jt*1e3).toFixed(0).padStart(9," ")}ns (avg${(xt/ut*1e3).toFixed(0).padStart(9," ")}ns)`].join(`
`))}if(!navigator.gpu)throw new TypeError("Your browser does not support WebGPU.");var Hn=document.getElementById("canvas");if(!(Hn instanceof HTMLCanvasElement))throw new TypeError("Failed to find the canvas element.");var Qt=Hn.getContext("webgpu")??ye(new TypeError("Failed to get WebGPU canvas context.")),Kt=navigator.gpu.getPreferredCanvasFormat(),{device:Jt,resize:De,render:ge,getBlock:ft,setBlock:zt}=await Ft(Kt,{onGpuTime:a=>{Nt=a,gt+=a,Kn++,kt(),Kn>300&&(gt=0n,Kn=0n)},onMeshBuildTime:a=>{jt=a,xt+=a,ut++,kt(),ut>100&&(xt=0,ut=0)}}),Ht=0;setInterval(()=>{zt(1,30,1,Ht%2===0?3:0),Ht++},500);Jt.addEventListener("uncapturederror",a=>{a instanceof GPUUncapturedErrorEvent&&At(a.error)});Qt.configure({device:Jt,format:Kt});new ResizeObserver(([{contentBoxSize:a}])=>{let[{blockSize:g,inlineSize:E}]=a;Hn.width=E,Hn.height=g,De(E,g),Qn===null&&Ct()}).observe(Hn);var En={};document.addEventListener("keydown",a=>{a.target!==document&&a.target!==document.body||(En[a.key.toLowerCase()]=!0,a.key==="c"&&(Tt=!Tt),a.key==="f"&&(at=!at),document.pointerLockElement===Hn&&a.preventDefault())});document.addEventListener("keyup",a=>{En[a.key.toLowerCase()]=!1});window.addEventListener("blur",()=>{En={}});Hn.addEventListener("click",()=>{Hn.requestPointerLock()});Hn.addEventListener("mousemove",a=>{document.pointerLockElement===Hn&&(V.yaw+=a.movementX/500,V.pitch+=a.movementY/500,V.pitch>Math.PI/2?V.pitch=Math.PI/2:V.pitch<-Math.PI/2&&(V.pitch=-Math.PI/2))});var pt=50,xe=30,ke=10,_t=-5,Yn=.3,Pt=1.4,Yt=.2,bn=.01,V={x:0,xv:0,y:j+1.5,yv:0,z:16,zv:0,yaw:0,pitch:0,roll:0},Tt=!0,at=!0;function Mt(a,g,E,U){let A=V[`${a}v`]+g*E;!U&&Math.sign(V[`${a}v`])!==Math.sign(A)&&!(at&&a==="y")&&(A=0);let G=(V[`${a}v`]+A)/2*E;if(Tt){let W={x:[Math.floor(V.x-Yn+bn),Math.floor(V.x+Yn-bn)],y:[Math.floor(V.y-Pt+bn),Math.floor(V.y+Yt-bn)],z:[Math.floor(V.z-Yn+bn),Math.floor(V.z+Yn-bn)]},$=a==="y"?G>0?Yt:Pt:Yn,X=G>0?Math.floor(V[a]+$):Math.floor(V[a]-$);n:for(;G>0?X<=V[a]+$+G:X>=Math.floor(V[a]-$+G);){let Z={...W,[a]:[X,X]};for(let F=Z.x[0];F<=Z.x[1];F++)for(let Q=Z.y[0];Q<=Z.y[1];Q++)for(let K=Z.z[0];K<=Z.z[1];K++)if(rt(ft(F,Q,K))){(G>0&&A>0||G<0&&A<0)&&(A=0),G=(G>0?Math.max(X-$,V[a]):Math.min(X+1+$,V[a]))-V[a];break n}G>0?X++:X--}}V[a]+=G,V[`${a}v`]=A}var Xt=Date.now(),Qn=null;function Ct(){let a=performance.now(),g=Date.now(),E=Math.min(g-Xt,100)/1e3;Xt=g;let U=new dt(V.xv,V.zv),A=U.lengthSquared>0?U.scale(_t):new dt,R=new dt(0,0);(En.a||En.arrowleft)&&R.add({x:-1}),(En.d||En.arrowright)&&R.add({x:1}),(En.w||En.arrowup)&&R.add({y:-1}),(En.s||En.arrowdown)&&R.add({y:1});let G=R.lengthSquared>0;G&&A.add(R.unit().scale(pt).rotate(V.yaw));let W=V.yv;if(at){if(W=-xe,En[" "]){let X=Math.floor(V.y-Pt-bn);n:for(let Z=Math.floor(V.x-Yn+bn);Z<=Math.floor(V.x+Yn-bn);Z++)for(let F=Math.floor(V.z-Yn+bn);F<=Math.floor(V.z+Yn-bn);F++)if(rt(ft(Z,X,F))){V.yv=ke;break n}}}else W*=_t,En[" "]&&(W+=pt),En.shift&&(W-=pt);Mt("x",A.x,E,G),Mt("z",A.y,E,G),Mt("y",W,E,En[" "]||En.shift),ge(Qt.getCurrentTexture(),Vn.translate(Vn.rotateY(Vn.rotateX(Vn.rotationZ(V.roll),V.pitch),V.yaw),[-V.x,-V.y,-V.z])).catch(X=>(Qn!==null&&(cancelAnimationFrame(Qn),Qn=null),Promise.reject(X))),Qn=requestAnimationFrame(Ct);let $=performance.now()-a;yt&&(Zt=$,Dt+=$,it++,kt(),it>300&&(Dt=0,it=0))}function ze(){let[a,g,E]=wt.transformMat4Upper3x3([0,0,-1],Vn.rotateZ(Vn.rotateX(Vn.rotationY(-V.yaw),-V.pitch),-V.roll)),U=Math.hypot(a,g,E),A=Wt((R,G,W)=>rt(ft(R,G,W)),[V.x,V.y,V.z],[a/U,g/U,E/U],64).next();return A.done?null:A.value}Hn.addEventListener("mousedown",a=>{let g=ze();if(g)switch(a.button){case 0:{zt(...g.block,0);break}case 1:case 2:{let E=wt.add(g.block,g.normal);ft(E[0],E[1],E[2])===0&&zt(E[0],E[1],E[2],3);break}}a.button});
